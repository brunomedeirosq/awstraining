CloudWatch

CloudWatch is a monitoring and observability service that you use to monitor your applications and automation services.

With CloudWatch, you can respond to system-wide performance changes, optimize resource usage, and get a unified view of operational health.

CloudWatch collects monitoring and operational data in the form of logs, metrics, and traces.

Amazon EC2 and many other AWS services have metrics monitored with CloudWatch.

CloudWatch elements:

- Metric: A metric represents a time-ordered set of data points that are published to CloudWatch.
          Think of a metric as a variable to monitor and the data points as representing the values of that variable over time.
          For example, ResourceCount is the number of specified Amazon EC2 resources running in your account.
          Metrics exist only in the Region in which they are created. Metrics cannot be deleted. Data points older than 15 months expire on a rolling basis.
          Amazon EC2 Auto Scaling metrics that collect information about Amazon EC2 Auto Scaling groups are in the AWS/AutoScaling namespace.
          EC2 instance metrics that collect CPU and other usage data from Amazon EC2 Auto Scaling instances are in the AWS/EC2 namespace.

- Dimensions: A dimension is a name-value pair that is part of the identity of a metric.
              Every metric has specific characteristics that describe it.
              You can think of dimensions as categories for those characteristics.
              You can use dimensions to filter data in CloudWatch. You can add additional dimensions to any metrics sent when using the CloudWatch agent.
              One way to collect metrics from an EC2 instance is by using the CloudWatch agent.
              When you create the configuration for the agent, you can add your own dimensions to the metrics you collect.
              There are four special dimensions the configuration supports.
              The dimension values are automatically replaced with the appropriate data for that EC2 instance.

                    - AutoScalingGroupName: Provides a view of all instances in a specified capacity group
                    - ImageId: Filters data for all instances running a particular Amazon EC2 AMI
                    - InstanceId: Filters data for just this requested instance
                    - InstanceType: Views all instances running with this specified instance type

- Dashboards: CloudWatch has both default dashboards and dashboards you can build and customize to your own needs.
              You can create dashboards to view your resources in a single view alongside other related data, such as application data.
              You can use CloudWatch dashboards to create customized views of the metrics, alarms, and log data for your AWS resources.
              https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Dashboards.html

- Alarms: You can use CloudWatch alarms to watch CloudWatch metrics and receive notifications when the metrics fall outside the levels, or high or low thresholds, you configure.
          For example, you can create an alarm to email an administrator when request latency exceeds a particular threshold. You can attach multiple alarms to each metric.
          Each alarm can have multiple actions, such as publishing to Amazon SNS topics or controlling the behavior of your Amazon EC2 Auto Scaling group.
          Amazon SNS is a managed service that provides email message delivery. https://docs.aws.amazon.com/sns/latest/dg/welcome.html

          Alarm state:
          - OK The metric is in the range you have defined as acceptable.
          - ALARM The metric is outside the defined threshold.
          - INSUFFICIENT_DATA The alarm has just started, the metric is not available, or not enough data is available.

Observability with CloudWatch:

You can use CloudWatch to collect and track metrics, collect and monitor log files, and set alarms.
CloudWatch can monitor AWS resources using built-in or custom metrics generated by your applications and services.
It can monitor any log files that your applications generate.
CloudWatch provides system-wide visibility into resource use, application performance, operational health, and user experience.
You can use these insights to react to performance or operation issues and to keep your application running smoothly.

https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/aws-services-cloudwatch-metrics.html

Data retention and collection:

CloudWatch metrics are retained for a period of 15 months.
As for data collection, EC2 instances have two default metric monitoring options: basic or detailed.
The basic option provides 5-minute granularity, whereas the detailed option provides updates every 1 minute.

collection period and the charges associated with each monitoring type:
    Basic Monitoring - Amazon EC2 sends metric data to CloudWatch in 5-minute periods. - There is no charge.
    Detailed Monitoring - Data is available in 1-minute periods. To get this level of data, you must specifically turn it on for the instance.
                          For the instances where you have turned on detailed monitoring, you can also get aggregated data across groups of similar instances. - You are charged for each metric sent to CloudWatch.
                                                                                                                                                                 You are not charged for data storage.

https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/cloudwatch_concepts.html#Metric

Installing the CloudWatch agent on the AMI

The install process includes the following three steps:
1. Create IAM roles and users for use with the CloudWatch agent.
2. Download the agent.
3. Create and modify the agent configuration file.

Installing the CloudWatch Agent Using Systems Manager - https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/installing-cloudwatch-agent-ssm.html

Creating the configuration file

The CloudWatch agent configuration file is a JSON file with three sections: agent, metrics, and logs. They are described as follows:

- The agent section includes fields for the overall configuration of the agent.
- The metrics section specifies the custom metrics for collection and publishing to CloudWatch.
  If you use the agent only to collect logs, you can omit the metrics section from the file.
- The logs section specifies which log files are published to Amazon CloudWatch Logs. This can include events from the Windows Event Log if the server runs Windows Server.

Creating the configuration file. For step-by-step instructions - https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/create-cloudwatch-agent-configuration-file.html

Alarms, dashboards, and visuals

A CloudWatch alarm invokes actions only when the alarm changes state.
The exception for this is for any alarms configured with Amazon EC2 Auto Scaling actions.
For Amazon EC2 Auto Scaling actions, the alarm continues to invoke the action once per minute that the alarm remains in the new state.
It's important to have actions set for your alarms.
CloudWatch doesn't test or validate the actions you specify.
It also doesn't detect any Amazon EC2 Auto Scaling errors resulting from an attempt to invoke nonexistent actions.

After you have collected your data and are ready to analyze it, you can access or view the data in two places as follows:

- Amazon EC2 console: This provides graphs showing the default Amazon EC2 metrics CloudWatch collects.
- CloudWatch console: This provides you with a more comprehensive view of your data. It also provides the ability to customize your view of the data.
  This includes filtering and querying to focus on the data that suits your business observability objectives.

A CloudWatch dashboard is a customized page you use to view and monitor your resources.
It provides a single view of resources across Regions.

For detailed information about implementing alarms and dashboards:
https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch_Dashboards.html
https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/AlarmThatSendsEmail.html

One Observability Workshop
This workshop provides hands-on experience with the wide variety of tool sets AWS offers to set up monitoring and observability on your applications.
https://catalog.workshops.aws/observability/en-US/aws-native








